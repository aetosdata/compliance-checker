<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>What's Your Risk?</title>
    <style>
        /* Basic CSS - mostly carried over, with additions for step management */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 20px;
            background-color: #e4e4e4; /* Updated background color */
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #447073; /* Updated H1/H2 color */
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        input[type="text"],
        input[type="email"],
        select,
        textarea {
            width: calc(100% - 20px); /* Adjust for padding */
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #447073; /* Updated button background color */
            color: #e4e4e4; /* Updated button font color */
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
            margin-right: 10px; /* Space between buttons */
        }
        button:hover {
            background-color: #315052; /* A slightly darker shade for hover effect */
        }
        button#prevStep {
            background-color: #6c757d; /* Grey for previous button, can be updated too if desired */
        }
        button#prevStep:hover {
            background-color: #5a6268;
        }

        .form-intro {
            text-align: center; /* Center the intro text and button */
        }
        .form-step {
            display: none; /* All steps hidden by default, JS will show the first */
            padding-top: 20px;
            border-top: 1px solid #eee;
            margin-top: 20px;
        }
        .form-step.active {
            display: block; /* Active step is shown */
        }
        .radio-group label, .checkbox-group label {
            display: inline-block; /* For radio/checkbox labels */
            margin-right: 15px;
            margin-bottom: 10px;
            font-weight: normal;
        }
        .radio-group input[type="radio"], .checkbox-group input[type="checkbox"] {
            margin-right: 5px;
            width: auto; /* Override general input width */
        }


        #results-section {
            display: none; /* Controlled by JavaScript */
            margin-top: 30px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
        .regulation-item {
            background-color: #e9f7ff;
            border-left: 5px solid #447073; /* Updated accent color here! */
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 4px;
        }
        .regulation-item h3 {
            margin-top: 0;
            color: #447073; /* Updated heading color here! */
        }
        .error-message {
            color: red;
            margin-bottom: 10px;
        }
        .navigation-buttons {
            margin-top: 20px;
            text-align: right; /* Align buttons to the right */
        }
        .navigation-buttons button {
            margin-left: 10px; /* Space between nav buttons */
        }
        .disclaimer {
            font-size: 0.8em; /* Smaller font size */
            color: #666;
            margin-top: 20px;
            padding-top: 10px;
            border-top: 1px dashed #eee;
            margin-bottom: 20px; /* Space before the new button */
        }
        .small-text {
            font-size: 0.9em;
            color: #555;
            margin-top: -10px; /* Pull it closer to the question */
            margin-bottom: 15px;
        }
        /* Style for required radio/checkbox groups if not selected */
        .invalid-group-border {
            border: 1px solid red;
            padding: 10px;
            border-radius: 5px;
        }
        /* Styles for Risk Score Numbers */
        .risk-score-value {
            font-size: 1.2em; /* Increased font size */
            font-weight: bold;
        }
        .risk-low {
            color: #28a745; /* Green */
        }
        .risk-medium {
            color: #ffc107; /* Orange */
        }
        .risk-high {
            color: #dc3545; /* Red */
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>What's Your Risk?</h1>
        <div class="form-intro">
            <p>Let's be honest: terms like 'GDPR' and 'CCPA' are enough to make any business owner's head spin. You know data compliance is important, but figuring out what actually applies to&nbsp;you&nbsp;can feel like trying to put together a puzzle in the dark.</p>
            <p>Consider this your flashlight. This brief check-up will help illuminate your potential obligations. By answering a few questions, you'll get a personalized snapshot that translates regulatory jargon into a practical starting point.</p>
            <p class="disclaimer">Disclaimer: This is not legal advice. The results are for informational purposes only. By using this tool, you agree that we may contact you to discuss your results and our services.</p>
            <button type="button" id="startAnalysisButton" onclick="handleStartAnalysisClick()">Start Analysis</button> </div>

        <div id="regulationFormContainer" style="display: none;">
            <div class="form-step" data-step="1">
                <h2>Your Industry</h2>
                <div class="form-group radio-group" data-group-name="industry">
                    <p>What industry does your business operate in?</p>
                    <label><input type="radio" name="industry" value="technology" required> Technology/SaaS</label><br>
                    <label><input type="radio" name="industry" value="healthcare" required> Healthcare/Life Sciences</label><br>
                    <label><input type="radio" name="industry" value="ecommerce" required> E-commerce/Retail</label><br>
                    <label><input type="radio" name="industry" value="financial_services" required> Financial Services</label><br>
                    <label><input type="radio" name="industry" value="marketing_advertising" required> Marketing/Advertising</label><br>
                    <label><input type="radio" name="industry" value="education" required> Education</label><br>
                    <label><input type="radio" name="industry" value="other_industry" required> Other</label>
                </div>
                <div class="navigation-buttons">
                    <button type="button" id="nextStep1">Next</button>
                </div>
            </div>

            <div class="form-step" data-step="2">
                <h2>Company Details</h2>
                <div class="form-group radio-group" data-group-name="companySize">
                    <p>What is the approximate size of your company?</p>
                    <label><input type="radio" name="companySize" value="1-10" required> 1-10 employees</label><br>
                    <label><input type="radio" name="companySize" value="11-50" required> 11-50 employees</label><br>
                    <label><input type="radio" name="companySize" value="51-250" required> 51-250 employees</label><br>
                    <label><input type="radio" name="companySize" value="251-1000" required> 251-1,000 employees</label><br>
                    <label><input type="radio" name="companySize" value="over_1000" required> Over 1,000 employees</label>
                </div>
                <div class="form-group radio-group" data-group-name="annualRevenue">
                    <p>What is your approximate annual revenue?</p>
                    <p class="small-text">This helps us determine the potential level of scrutiny and scale of compliance penalties.</p>
                    <label><input type="radio" name="annualRevenue" value="1-249k" required> $1 - $249k</label><br>
                    <label><input type="radio" name="annualRevenue" value="250k-499k" required> $250k - $499k</label><br>
                    <label><input type="radio" name="annualRevenue" value="500k-749k" required> $500k - $749k</label><br>
                    <label><input type="radio" name="annualRevenue" value="750k-999k" required> $750k - $999k</label><br>
                    <label><input type="radio" name="annualRevenue" value="1M+" required> $1M+</label>
                </div>
                <div class="navigation-buttons">
                    <button type="button" id="prevStep2">Previous</button>
                    <button type="button" id="nextStep2">Next</button>
                </div>
            </div>

            <div class="form-step" data-step="3">
                <h2>Your Customers</h2>
                <div class="form-group checkbox-group" data-group-name="customerLocation">
                    <p>Where are your customers located?</p>
                    <p class="small-text">Select all that apply.</p>
                    <label><input type="checkbox" name="customerLocation" value="united_states"> United States</label><br>
                    <label><input type="checkbox" name="customerLocation" value="european_union"> European Union</label><br>
                    <label><input type="checkbox" name="customerLocation" value="united_kingdom"> United Kingdom</label><br>
                    <label><input type="checkbox" name="customerLocation" value="other_general"> Other/General</label>
                </div>
                <div class="form-group radio-group" data-group-name="customerType">
                    <p>Who are your customers?</p>
                    <label><input type="radio" name="customerType" value="consumers" required> Consumers</label><br>
                    <label><input type="radio" name="customerType" value="businesses" required> Businesses</label><br>
                    <label><input type="radio" name="customerType" value="both" required> Both</label>
                </div>
                <div class="navigation-buttons">
                    <button type="button" id="prevStep3">Previous</button>
                    <button type="button" id="nextStep3">Next</button>
                </div>
            </div>

            <div class="form-step" data-step="4">
                <h2>Data Collected</h2>
                <div class="form-group checkbox-group" data-group-name="dataType">
                    <p>What types of data do you collect or process?</p>
                    <p class="small-text">Select all that apply.</p>
                    <label><input type="checkbox" name="dataType" value="basic_contact"> Basic contact info</label><br>
                    <label><input type="checkbox" name="dataType" value="health_phi"> Health or medical information (PHI)</label><br>
                    <label><input type="checkbox" name="dataType" value="genetics"> Genetics</label><br>
                    <label><input type="checkbox" name="dataType" value="financial"> Financial information (credit card numbers, bank accounts)</label><br>
                    <label><input type="checkbox" name="dataType" value="biometrics"> Biometrics</label><br>
                    <label><input type="checkbox" name="dataType" value="under_16"> Data on individuals under 16 years old</label><br>
                    <label><input type="checkbox" name="dataType" value="racial_ethnic"> Racial or ethnic origin</label><br>
                    <label><input type="checkbox" name="dataType" value="political_opinion"> Political opinions (including trade union membership)</label><br>
                    <label><input type="checkbox" name="dataType" value="religious_philosophical"> Religious or philosophical beliefs</label><br>
                    <label><input type="checkbox" name="dataType" value="sex_life_orientation"> Sex life or orientation</label>
                </div>
                <div class="navigation-buttons">
                    <button type="button" id="prevStep4">Previous</button>
                    <button type="button" id="nextStep4">Next</button>
                </div>
            </div>

            <div class="form-step" data-step="5">
                <h2>Where should we send your report?</h2>
                <div class="form-group">
                    <label for="fullName">Full Name:</label>
                    <input type="text" id="fullName" name="fullName" placeholder="John Doe" required>
                </div>
                <div class="form-group">
                    <label for="businessName">Business Name:</label>
                    <input type="text" id="businessName" name="businessName" placeholder="e.g., Acme Co." required>
                </div>
                <div class="form-group">
                    <label for="yourEmail">Email:</label>
                    <input type="email" id="yourEmail" name="yourEmail" placeholder="your@example.com" required>
                </div>
                <div class="navigation-buttons">
                    <button type="button" id="prevStep5">Previous</button>
                    <button type="button" id="generateReportButton">Generate Report</button>
                </div>
            </div>
        </div> <div id="results-section">
            <h2>Your Customized Risk Analysis for <span id="reportBusinessName"></span></h2>
            <p>Based on your answers, we have estimated an approximate risk level for your business. The lower the score, the lower your business's estimated individual risk.</p>
            <p>Please note that every business is different, and this is based on only a few data points. For a more in-depth analysis, you can reach out to us for a <a href="https://www.aetos-data.com/contact" target="_blank" style="color: #447073; text-decoration: none;">free preliminary consultation</a>.</p>
            <div id="regulationsOutput">
                </div>
            <p>A copy of this report has been sent to <strong id="reportEmailAddress"></strong>.</p>
            <p style="display: none;">
                <a id="emailReportLink" href="#" target="_blank" style="color: #447073; text-decoration: none;">Click here to email this report to yourself (opens in your email client).</a>
            </p>
            <button id="startOverButton" style="margin-top: 20px;">Start Over</button>
            <div class="next-steps-section">
                <h3>See the Full Picture</h3>
                <p>You've seen the tip of the iceberg. The free assessment flags potential vulnerabilities. For just $75, our Comprehensive Assessment dives deep to uncover your full risk profile and gives you a clear plan to mitigate it.</p>
                <a href="https://www.aetos-data.com/services/p/compliance-snapshot-expert-review" target="_blank" class="action-button">Uncover My Full Risk Profile</a>
            </div>
        </div>
    </div>

    <script>
        console.log("Script started executing: " + new Date().toLocaleString()); // Debug: Script started with timestamp

        // Define handleStartAnalysisClick globally so it can be called by onclick attribute
        function handleStartAnalysisClick() {
            console.log("Start Analysis button clicked. Attempting transition to form."); // Debug Log
            try {
                const formIntro = document.querySelector('.form-intro');
                const regulationFormContainer = document.getElementById('regulationFormContainer');
                const formSteps = document.querySelectorAll('.form-step'); // Need to define this here too for showStep

                if (formIntro && regulationFormContainer && formSteps.length > 0) {
                    formIntro.style.display = 'none'; // Hide the intro section
                    regulationFormContainer.style.display = 'block'; // Show the form container
                    showStep(0); // Show the very first step of the form (Step 1 - Industry)
                    console.log("Transition to form completed.");
                } else {
                    console.error("Critical: DOM elements not found for Start Analysis button's action.");
                }
            } catch (e) {
                console.error("Error in handleStartAnalysisClick:", e);
                alert("An error occurred starting the analysis. Please check the console.");
            }
        }


        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM fully loaded and parsed. Initializing app. (Inside DOMContentLoaded)"); // Debug: DOM loaded

            // --- Configuration: Your Zapier Webhook URL ---
            const ZAPIER_WEBHOOK_URL = 'https://hooks.zapier.com/hooks/catch/21168350/u2yjtw7/'; // Your specific Zapier Webhook URL

            try {
                // DOM Elements
                const formIntro = document.querySelector('.form-intro');
                const regulationFormContainer = document.getElementById('regulationFormContainer');
                const startAnalysisButton = document.getElementById('startAnalysisButton');
                const formSteps = document.querySelectorAll('.form-step');
                const resultsSection = document.getElementById('results-section');
                const reportBusinessNameSpan = document.getElementById('reportBusinessName');
                const reportEmailAddressStrong = document.getElementById('reportEmailAddress');
                const regulationsOutput = document.getElementById('regulationsOutput');
                const emailReportLink = document.getElementById('emailReportLink');
                const startOverButton = document.getElementById('startOverButton');
                const generateReportButton = document.getElementById('generateReportButton');
                const nextStepsButtonInResults = resultsSection.querySelector('.next-steps-section .action-button'); // Selecting the link

                // Ensure all critical elements are found immediately
                if (!formIntro || !regulationFormContainer || formSteps.length === 0 || !startAnalysisButton || !resultsSection || !generateReportButton) {
                    console.error("FATAL ERROR: One or more critical DOM elements could not be found on DOMContentLoaded.");
                    console.error("formIntro:", formIntro, "regulationFormContainer:", regulationFormContainer, "formSteps.length:", formSteps.length, "startAnalysisButton:", startAnalysisButton, "resultsSection:", resultsSection, "generateReportButton:", generateReportButton);
                    alert("App failed to initialize. Please contact support and mention console errors.");
                    return; // Stop further execution if critical elements are missing
                }
                console.log("All critical DOM elements found."); // Debug Log


                let currentStep = 0;
                const totalSteps = formSteps.length;

                // --- Regulatory Data Definition (with Base Scores and Priority) ---
                const regulationsData = [
                    {
                        name: "GDPR (General Data Protection Regulation)",
                        description: "A comprehensive data privacy law protecting individuals within the European Union and European Economic Area. It applies to any organization, regardless of its location, that processes personal data of EU residents.",
                        conditions: {
                            customerLocation: ['european_union'],
                            customerType: ['consumers', 'businesses', 'both'],
                            dataType: ['basic_contact', 'health_phi', 'genetics', 'financial', 'biometrics', 'under_16', 'racial_ethnic', 'political_opinion', 'religious_philosophical', 'sex_life_orientation']
                        },
                        baseScore: 100,
                        priority: 1
                    },
                    {
                        name: "UK GDPR (General Data Protection Regulation)",
                        description: "A comprehensive data privacy law protecting individuals within the United Kingdom. It applies to any organization in or targeting individuals in the UK.",
                        conditions: {
                            customerLocation: ['united_kingdom'],
                            customerType: ['consumers', 'businesses', 'both'],
                            dataType: ['basic_contact', 'health_phi', 'genetics', 'financial', 'biometrics', 'under_16', 'racial_ethnic', 'political_opinion', 'religious_philosophical', 'sex_life_orientation']
                        },
                        baseScore: 100,
                        priority: 3
                    },
                    {
                        name: "ePrivacy Directive",
                        description: "ePrivacy refers to a set of laws and regulations, most notably the ePrivacy Directive in the EU, that aim to protect the privacy of electronic communications and user data online, particularly concerning cookies, direct marketing, and confidentiality of communications. It applies to any organization, regardless of its location, that processes personal data of EU residents.",
                        conditions: {
                            customerLocation: ['european_union'],
                            customerType: ['consumers', 'businesses', 'both'],
                            dataType: ['basic_contact', 'health_phi', 'genetics', 'financial', 'biometrics', 'under_16', 'racial_ethnic', 'political_opinion', 'religious_philosophical', 'sex_life_orientation']
                        },
                        baseScore: 42,
                        priority: 4
                    },
                    {
                        name: "Privacy & Electronic Communications Regulations (PECR)",
                        description: "The UK's national implementation of the original EU ePrivacy Directive. ePrivacy refers to a set of laws and regulations, that aim to protect the privacy of electronic communications and user data online, particularly concerning cookies, direct marketing, and confidentiality of communications. It applies to any organization, regardless of its location, that processes personal data of UK residents.",
                        conditions: {
                            customerLocation: ['united_kingdom'],
                            customerType: ['consumers', 'businesses', 'both'],
                            dataType: ['basic_contact', 'health_phi', 'genetics', 'financial', 'biometrics', 'under_16', 'racial_ethnic', 'political_opinion', 'religious_philosophical', 'sex_life_orientation']
                        },
                        baseScore: 42,
                        priority: 5
                    },
                    {
                        name: "Data Protection Act of 2018",
                        description: "A regulation that complements the UK GDPR and grants individuals rights regarding their personal data. It applies to any organization in or targeting individuals in the UK.",
                        conditions: {
                            customerLocation: ['united_kingdom'],
                            customerType: ['consumers', 'businesses', 'both'],
                            dataType: ['basic_contact', 'health_phi', 'genetics', 'financial', 'biometrics', 'under_16', 'racial_ethnic', 'political_opinion', 'religious_philosophical', 'sex_life_orientation']
                        },
                        baseScore: 49,
                        priority: 6
                    },
                    {
                        name: "CCPA (California Consumer Privacy Act)",
                        description: "The California Consumer Privacy Act grants California consumers specific rights regarding their personal information collected by businesses, including the right to know, delete, and opt-out of the sale of their data. For businesses that meet specific thresholds (e.g., revenue, data processing volume).",
                        conditions: {
                            customerLocation: ['united_states'],
                            customerType: ['consumers', 'businesses', 'both'],
                            annualRevenue: ['1M+', '750k-999k', '500k-749k', '250k-499k', '1-249k'],
                            dataType: ['basic_contact', 'health_phi', 'genetics', 'financial', 'biometrics', 'under_16', 'racial_ethnic', 'political_opinion', 'religious_philosophical', 'sex_life_orientation']
                        },
                        baseScore: 56,
                        priority: 7
                    },
                    {
                        name: "CAN-SPAM",
                        description: "The Controlling the Assault of Non-Solicited Pornography And Marketing Act of 2003 establishes national standards for the sending of commercial emails, primarily requiring accurate sender information, clear identification of advertisements, and an easy opt-out mechanism.",
                        conditions: {
                            customerLocation: ['united_states'],
                            customerType: ['consumers', 'businesses', 'both'],
                            dataType: ['basic_contact', 'health_phi', 'genetics', 'financial', 'biometrics', 'under_16', 'racial_ethnic', 'political_opinion', 'religious_philosophical', 'sex_life_orientation']
                        },
                        baseScore: 20,
                        priority: 8
                    },
                    {
                        name: "VPPA (Video Privacy Protection Act)",
                        description: "The Video Privacy Protection Act prohibits video tape service providers from knowingly disclosing personally identifiable information about a consumer's video rentals without their informed, written consent.",
                        conditions: {
                            customerLocation: ['united_states'],
                            customerType: ['consumers', 'businesses', 'both'],
                            dataType: ['basic_contact', 'health_phi', 'genetics', 'financial', 'biometrics', 'under_16', 'racial_ethnic', 'political_opinion', 'religious_philosophical', 'sex_life_orientation']
                        },
                        baseScore: 12,
                        priority: 9
                    },
                    {
                        name: "HIPAA (Health Insurance Portability and Accountability Act)",
                        description: "A U.S. law protecting sensitive patient health information from being disclosed without the patient's consent or knowledge. Applies primarily to healthcare providers, health plans, and healthcare clearinghouses.",
                        conditions: {
                            industry: ['healthcare'],
                            customerLocation: ['united_states'],
                            dataType: ['health_phi']
                        },
                        baseScore: 64,
                        priority: 10
                    },
                    {
                        name: "CIPA (Children's Internet Protection Act)",
                        description: "The Children's Internet Protection Act requires schools and libraries that receive federal funding for internet access to implement internet safety policies, including technology protection measures to block or filter obscene or harmful content for minors.",
                        conditions: {
                            customerLocation: ['united_states'],
                            industry: ['education']
                        },
                        baseScore: 6,
                        priority: 11
                    },
                    {
                        name: "TCPA (Telephone Consumer Protection Act)",
                        description: "The Telephone Consumer Protection Act restricts telemarketing calls, automatic telephone dialing systems, and artificial or prerecorded voice messages, requiring prior consent for many types of calls and texts.",
                        conditions: {
                            customerLocation: ['united_states'],
                            customerType: ['consumers', 'businesses', 'both'],
                            dataType: ['basic_contact', 'health_phi', 'genetics', 'financial', 'biometrics', 'under_16', 'racial_ethnic', 'political_opinion', 'religious_philosophical', 'sex_life_orientation']
                        },
                        baseScore: 56,
                        priority: 12
                    },
                    {
                        name: "GLBA (Gramm-Leach-Bliley Act)",
                        description: "The Gramm-Leach-Bliley Act requires financial institutions to explain their information-sharing practices to customers and to safeguard sensitive data, covering privacy, security, and pretexting rules.",
                        conditions: {
                            customerLocation: ['united_states'],
                            customerType: ['consumers', 'businesses', 'both'],
                            dataType: ['financial']
                        },
                        baseScore: 25,
                        priority: 13
                    },
                    {
                        name: "COPPA (Children's Online Privacy Protection Act)",
                        description: "The Children's Online Privacy Protection Act imposes requirements on operators of websites or online services directed at children under 13, or that knowingly collect personal information from children under 13, to obtain verifiable parental consent.",
                        conditions: {
                            customerLocation: ['united_states'],
                            customerType: ['consumers', 'businesses', 'both'],
                            dataType: ['under_16']
                        },
                        baseScore: 81,
                        priority: 14
                    },
                    {
                        name: "BIPA (Illinois Biometric Information Privacy Act)",
                        description: "The Illinois Biometric Information Privacy Act requires private entities to obtain written consent before collecting, capturing, purchasing, receiving, or otherwise obtaining a person's biometric identifiers or biometric information, and places restrictions on the storage, use, and disclosure of such data.",
                        conditions: {
                            customerLocation: ['united_states'],
                            customerType: ['consumers', 'businesses', 'both'],
                            dataType: ['biometrics']
                        },
                        baseScore: 81,
                        priority: 15
                    },
                    {
                        name: "Federal Trade Commission (FTC)",
                        description: "The FTC serves as the primary federal agency protecting consumer privacy in the United States by prohibiting unfair or deceptive acts and practices, especially concerning how companies collect, use, and secure personal data across various industries (excluding certain regulated sectors).",
                        conditions: {
                            customerLocation: ['united_states']
                        },
                        baseScore: 30,
                        priority: 16
                    },
                    {
                        name: "Federal Communications Commission (FCC)",
                        description: "The FCC primarily focuses on protecting consumer privacy within the telecommunications sector, setting rules for how phone companies, internet service providers, and other communication service providers handle sensitive customer data like Customer Proprietary Network Information (CPNI).",
                        conditions: {
                            customerLocation: ['united_states'],
                            industry: ['technology', 'healthcare', 'ecommerce', 'financial_services', 'marketing_advertising', 'education', 'other_industry']
                        },
                        baseScore: 28,
                        priority: 17
                    }
                ];

                // --- Coefficients Data ---
                const coefficientsData = {
                    companySize: {
                        '51-250': 1.4,
                        '251-1000': 1.6,
                        'over_1000': 2
                    },
                    industry: {
                        'technology': 1.8,
                        'healthcare': 2,
                        'ecommerce': 1.2,
                        'financial_services': 1.6,
                        'marketing_advertising': 1.4,
                        'education': 0.8
                    },
                    // dataType is commented out as it has no coefficients yet
                };

                // --- Step Navigation Functions ---
                function showStep(stepIndex) {
                    formSteps.forEach((step, index) => {
                        if (index === stepIndex) {
                            step.classList.add('active');
                        } else {
                            step.classList.remove('active');
                        }
                    });
                    currentStep = stepIndex;
                }

                // Function to validate the current step's inputs
                function validateStep(stepIndex) {
                    let isValid = true;
                    const currentStepElement = formSteps[stepIndex];

                    // 1. Validate text/email/select inputs with 'required' attribute
                    const requiredInputs = currentStepElement.querySelectorAll('input[required]:not([type="radio"]):not([type="checkbox"]), select[required], textarea[required]');
                    requiredInputs.forEach(input => {
                        if (!input.value.trim()) {
                            input.style.borderColor = 'red';
                            isValid = false;
                        } else {
                            input.style.borderColor = '#ddd';
                        }
                    });

                    // 2. Validate Radio button groups
                    const radioGroups = currentStepElement.querySelectorAll('.radio-group[data-group-name]');
                    radioGroups.forEach(group => {
                        const groupName = group.dataset.groupName;
                        const radiosInGroup = currentStepElement.querySelectorAll(`input[name="${groupName}"]`);
                        const isChecked = Array.from(radiosInGroup).some(radio => radio.checked);

                        if (!isChecked) {
                            group.classList.add('invalid-group-border');
                            isValid = false;
                        } else {
                            group.classList.remove('invalid-group-border');
                        }
                    });

                    // 3. Validate Checkbox groups
                    const checkboxGroups = currentStepElement.querySelectorAll('.checkbox-group[data-group-name]');
                    checkboxGroups.forEach(group => {
                        const groupName = group.dataset.groupName;
                        const checkboxesInGroup = currentStepElement.querySelectorAll(`input[name="${groupName}"]`);
                        const isChecked = Array.from(checkboxesInGroup).some(checkbox => checkbox.checked);

                        if (!isChecked) {
                            group.classList.add('invalid-group-border');
                            isValid = false;
                        } else {
                            group.classList.remove('invalid-group-border');
                        }
                    });

                    return isValid;
                }

                // --- Event Listeners ---

                // 2. "Next" Buttons
                document.getElementById('nextStep1').addEventListener('click', function() {
                    if (validateStep(0)) { showStep(1); } else { alert('Please complete all required fields in this section to proceed.'); }
                });
                document.getElementById('nextStep2').addEventListener('click', function() {
                    if (validateStep(1)) { showStep(2); } else { alert('Please complete all required fields in this section to proceed.'); }
                });
                document.getElementById('nextStep3').addEventListener('click', function() {
                    if (validateStep(2)) { showStep(3); } else { alert('Please complete all required fields in this section to proceed.'); }
                });
                document.getElementById('nextStep4').addEventListener('click', function() {
                    if (validateStep(3)) { showStep(4); } else { alert('Please complete all required fields in this section to proceed.'); }
                });

                // 3. "Previous" Buttons
                document.getElementById('prevStep2').addEventListener('click', function() { showStep(0); });
                document.getElementById('prevStep3').addEventListener('click', function() { showStep(1); });
                document.getElementById('prevStep4').addEventListener('click', function() { showStep(2); });
                document.getElementById('prevStep5').addEventListener('click', function() { showStep(3); });


                // --- Generate Report Function ---
                let finalApplicableRegulations = []; // Holds regulations with calculated scores for this report

                function generateReport(formData) {
                    let reportHtml = '';
                    finalApplicableRegulations = []; // Reset for each new report

                    // Calculate overallCoefficient based on user's selected answers
                    let overallCoefficient = 1;
                    for (const category in coefficientsData) {
                        if (Object.hasOwnProperty.call(coefficientsData, category)) {
                            const userSelection = formData[category];

                            if (userSelection) { // Only process if user actually selected something for this category
                                if (Array.isArray(userSelection)) { // For multi-select checkboxes (e.g., customerLocation, dataType)
                                    // For the user's specific input, we still multiply all SELECTED coefficients
                                    userSelection.forEach(selectedVal => {
                                        if (coefficientsData[category][selectedVal]) {
                                            overallCoefficient *= coefficientsData[category][selectedVal];
                                        }
                                    });
                                } else { // For single-select radios (e.g., industry, companySize, annualRevenue, customerType)
                                    if (coefficientsData[category][userSelection]) {
                                        overallCoefficient *= coefficientsData[category][userSelection];
                                    }
                                }
                            }
                        }
                    }
                    console.log("User's Overall Coefficient:", overallCoefficient); // For debugging


                    // Determine applicable regulations and calculate their scores
                    regulationsData.forEach(regulation => {
                        let applies = true; // Assume it applies until a condition fails

                        // Check each condition for the current regulation
                        for (const conditionKey in regulation.conditions) {
                            const requiredValues = regulation.conditions[conditionKey];
                            const userValues = formData[conditionKey];

                            // CRITICAL LOGGING FOR DEBUGGING
                            console.log(`\nRegulation: ${regulation.name}`);
                            console.log(`  Checking condition: ${conditionKey}`);
                            console.log(`    Required values for this condition:`, requiredValues);
                            console.log(`    User's input for this condition:`, userValues);

                            // Condition: User input is missing or empty for a required condition
                            if (userValues === null || userValues === undefined || (Array.isArray(userValues) && userValues.length === 0) || (typeof userValues === 'string' && userValues.trim() === '')) {
                                console.log(`    FAIL: User input for required condition '${conditionKey}' is missing or empty.`);
                                applies = false;
                                break;
                            }

                            // Condition: Check if user's selection matches required values
                            if (Array.isArray(userValues)) { // User input is an array (checkboxes, e.g., customerLocation, dataType)
                                // For multi-selects, check if AT LEAST ONE required value is present in user's selection
                                const hasIntersection = requiredValues.some(reqVal => userValues.includes(reqVal));
                                if (!hasIntersection) {
                                    console.log(`    FAIL: No overlap found between user's selected '${conditionKey}' and required values.`);
                                    applies = false;
                                    break;
                                } else {
                                    console.log(`    PASS: Overlap found for '${conditionKey}'.`);
                                }
                            } else { // User input is a single value (radio, select, text, e.g., industry, companySize, customerType, annualRevenue)
                                // For single-selects, check if the user's selected value is among the required values
                                if (!requiredValues.includes(userValues)) {
                                    console.log(`    FAIL: User's selected '${conditionKey}' ('${userValues}') is not among required values:`, requiredValues);
                                    applies = false;
                                    break;
                                } else {
                                    console.log(`    PASS: User's selected '${conditionKey}' ('${userValues}') is among required values.`);
                                }
                            }
                        } // End for (conditionKey in regulation.conditions)

                        if (applies) {
                            console.log(`=> Regulation APPLIES: ${regulation.name}`);
                            const calculatedRiskScore = (regulation.baseScore * overallCoefficient).toFixed(0);

                            finalApplicableRegulations.push({
                                ...regulation,
                                calculatedRiskScore: parseInt(calculatedRiskScore)
                            });
                        } else {
                            console.log(`=> Regulation DOES NOT APPLY: ${regulation.name}`);
                        }
                    }); // End regulationsData.forEach

                    // Sort applicable regulations by priority
                    finalApplicableRegulations.sort((a, b) => a.priority - b.priority);

                    if (finalApplicableRegulations.length > 0) {
                        reportHtml += ''; // Removed the intro text here
                        finalApplicableRegulations.forEach(reg => {
                            let scoreClass = '';
                            if (reg.calculatedRiskScore <= 25) {
                                scoreClass = 'risk-low';
                            } else if (reg.calculatedRiskScore <= 50) {
                                scoreClass = 'risk-medium';
                            } else {
                                scoreClass = 'risk-high';
                            }

                            reportHtml += `
                                <div class="regulation-item">
                                    <h3>${reg.name}</h3>
                                    <p>${reg.description}</p>
                                    <p><strong>Your estimated risk score (out of 100):</strong> <span class="risk-score-value ${scoreClass}">${reg.calculatedRiskScore}</span></p>
                                </div>
                            `;
                        });
                    } else {
                        reportHtml = '<p>Based on your input, we did not find any specific regulations from our current list that explicitly apply. Please remember this tool provides informational guidance only and is not legal advice. Always consult with a legal professional for comprehensive compliance advice.</p>';
                    }

                    return reportHtml;
                }

                // --- Form Submission (Generate Report Button) ---
                generateReportButton.addEventListener('click', async function(event) {
                    console.log("Generate Report button clicked."); // Debug Log

                    if (!validateStep(totalSteps - 1)) {
                        alert('Please complete all required fields to generate the report.');
                        return;
                    }

                    // Collect all form data manually
                    const formData = {
                        industry: document.querySelector('input[name="industry"]:checked')?.value || '',
                        companySize: document.querySelector('input[name="companySize"]:checked')?.value || '',
                        annualRevenue: document.querySelector('input[name="annualRevenue"]:checked')?.value || '',
                        customerLocation: Array.from(document.querySelectorAll('input[name="customerLocation"]:checked')).map(cb => cb.value),
                        customerType: document.querySelector('input[name="customerType"]:checked')?.value || '',
                        dataType: Array.from(document.querySelectorAll('input[name="dataType']:checked')).map(cb => cb.value),
                        fullName: document.getElementById('fullName').value.trim(),
                        businessName: document.getElementById('businessName').value.trim(),
                        yourEmail: document.getElementById('yourEmail').value.trim()
                    };
                    console.log("Collected formData:", formData); // Debug Log


                    // --- Generate Report ---
                    const reportContentHtml = generateReport(formData);
                    regulationsOutput.innerHTML = reportContentHtml;

                    // Update results section with user's business name and email
                    reportBusinessNameSpan.textContent = formData.businessName;
                    reportEmailAddressStrong.textContent = formData.yourEmail;

                    // Hide the form container and show the results
                    regulationFormContainer.style.display = 'none';
                    resultsSection.style.display = 'block';
                    console.log("Report displayed on site."); // Debug Log

                    // --- Send Data to Zapier Webhook (using URLSearchParams) ---
                    const ZAPIER_WEBHOOK_URL = 'https://hooks.zapier.com/hooks/catch/21168350/u2yjtw7/'; // Your specific Zapier Webhook URL

                    // Prepare data for URL-encoded format
                    const flattenedDataToSend = {
                        timestamp: new Date().toISOString(),
                        industry: formData.industry,
                        companySize: formData.companySize,
                        annualRevenue: formData.annualRevenue,
                        customerType: formData.customerType,
                        fullName: formData.fullName,
                        businessName: formData.businessName,
                        yourEmail: formData.yourEmail,
                        customerLocation: formData.customerLocation.join(', '),
                        dataType: formData.dataType.join(', '),
                        generatedReportHtml: reportContentHtml,
                        generatedReportPlainText: finalApplicableRegulations.length > 0 ?
                            "Applicable Regulations (Calculated Risk Score):\n\n" +
                            finalApplicableRegulations.map(reg => `${reg.name}: ${reg.description}\nYour estimated risk score (out of 100): ${reg.calculatedRiskScore}`).join('\n\n') :
                            'No specific regulations found based on your input.'
                    };
                    console.log("Data prepared for Zapier (URL-encoded):", flattenedDataToSend); // Debug Log

                    try {
                        const response = await fetch(ZAPIER_WEBHOOK_URL, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'
                            },
                            body: new URLSearchParams(flattenedDataToSend).toString()
                        });

                        if (response.ok) {
                            console.log('Data successfully sent to Zapier (URL-encoded)! Response OK.'); // Debug Log
                        } else {
                            console.error('Failed to send data to Zapier:', response.status, response.statusText); // Debug Log
                        }
                    } catch (error) {
                        console.error('Error sending data to Zapier:', error); // Debug Log
                    }

                    // --- Mailto Link for User's Copy ---
                    const reportPlainTextEmail = `
Dear ${formData.fullName || formData.businessName},

Here is your customized Business Regulation Report based on the information you provided:

Business Name: ${formData.businessName}
Your Email: ${formData.yourEmail}
Industry: ${formData.industry}
Company Size: ${formData.companySize}
Annual Revenue: ${formData.annualRevenue}
Customer Locations: ${formData.customerLocation.length > 0 ? formData.customerLocation.join(', ') : 'N/A'}
Customer

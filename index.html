<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>What's Your Risk?</title>
    <style>
        /* Basic CSS - mostly carried over, with additions for step management */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 20px;
            background-color: #e4e4e4; /* Updated background color */
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #447073; /* Updated H1/H2 color */
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        input[type="text"],
        input[type="email"],
        select,
        textarea {
            width: calc(100% - 20px); /* Adjust for padding */
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #447073; /* Updated button background color */
            color: #e4e4e4; /* Updated button font color */
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
            margin-right: 10px; /* Space between buttons */
        }
        button:hover {
            background-color: #315052; /* A slightly darker shade for hover effect */
        }
        button#prevStep {
            background-color: #6c757d; /* Grey for previous button, can be updated too if desired */
        }
        button#prevStep:hover {
            background-color: #5a6268;
        }

        .form-intro {
            text-align: center; /* Center the intro text and button */
        }
        .form-step {
            display: none; /* All steps hidden by default, JS will show the first */
            padding-top: 20px;
            border-top: 1px solid #eee;
            margin-top: 20px;
        }
        .form-step.active {
            display: block; /* Active step is shown */
        }
        .radio-group label, .checkbox-group label {
            display: inline-block; /* For radio/checkbox labels */
            margin-right: 15px;
            margin-bottom: 10px;
            font-weight: normal;
        }
        .radio-group input[type="radio"], .checkbox-group input[type="checkbox"] {
            margin-right: 5px;
            width: auto; /* Override general input width */
        }


        #results-section {
            display: none; /* Controlled by JavaScript */
            margin-top: 30px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
        .regulation-item {
            background-color: #e9f7ff;
            border-left: 5px solid #447073; /* Updated accent color here! */
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 4px;
        }
        .regulation-item h3 {
            margin-top: 0;
            color: #447073; /* Updated heading color here! */
        }
        .error-message {
            color: red;
            margin-bottom: 10px;
        }
        .navigation-buttons {
            margin-top: 20px;
            text-align: right; /* Align buttons to the right */
        }
        .navigation-buttons button {
            margin-left: 10px; /* Space between nav buttons */
        }
        .disclaimer {
            font-size: 0.8em; /* Smaller font size */
            color: #666;
            margin-top: 20px;
            padding-top: 10px;
            border-top: 1px dashed #eee;
            margin-bottom: 20px; /* Space before the new button */
        }
        .small-text {
            font-size: 0.9em;
            color: #555;
            margin-top: -10px; /* Pull it closer to the question */
            margin-bottom: 15px;
        }
        /* Style for required radio/checkbox groups if not selected */
        .invalid-group-border {
            border: 1px solid red;
            padding: 10px;
            border-radius: 5px;
        }
        /* Styles for Risk Score Numbers */
        .risk-score-value {
            font-size: 1.2em; /* Increased font size */
            font-weight: bold;
        }
        .risk-low {
            color: #28a745; /* Green */
        }
        .risk-medium {
            color: #ffc107; /* Orange */
        }
        .risk-high {
            color: #dc3545; /* Red */
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>What's Your Risk?</h1>
        <div class="form-intro">
            <p>Let's be honest: terms like 'GDPR' and 'CCPA' are enough to make any business owner's head spin. You know data compliance is important, but figuring out what actually applies to&nbsp;you&nbsp;can feel like trying to put together a puzzle in the dark.</p>
            <p>Consider this your flashlight. This brief check-up will help illuminate your potential obligations. By answering a few questions, you'll get a personalized snapshot that translates regulatory jargon into a practical starting point.</p>
            <p class="disclaimer">Disclaimer: This is not legal advice. The results are for informational purposes only. By using this tool, you agree that we may contact you to discuss your results and our services.</p>
            <button type="button" id="startAnalysisButton" onclick="handleStartAnalysisClick()">Start Analysis</button> </div>

        <div id="regulationFormContainer" style="display: none;">
            <div class="form-step" data-step="1">
                <h2>Your Industry</h2>
                <div class="form-group radio-group" data-group-name="industry">
                    <p>What industry does your business operate in?</p>
                    <label><input type="radio" name="industry" value="technology" required> Technology/SaaS</label><br>
                    <label><input type="radio" name="industry" value="healthcare" required> Healthcare/Life Sciences</label><br>
                    <label><input type="radio" name="industry" value="ecommerce" required> E-commerce/Retail</label><br>
                    <label><input type="radio" name="industry" value="financial_services" required> Financial Services</label><br>
                    <label><input type="radio" name="industry" value="marketing_advertising" required> Marketing/Advertising</label><br>
                    <label><input type="radio" name="industry" value="education" required> Education</label><br>
                    <label><input type="radio" name="industry" value="other_industry" required> Other</label>
                </div>
                <div class="navigation-buttons">
                    <button type="button" id="nextStep1">Next</button>
                </div>
            </div>

            <div class="form-step" data-step="2">
                <h2>Company Details</h2>
                <div class="form-group radio-group" data-group-name="companySize">
                    <p>What is the approximate size of your company?</p>
                    <label><input type="radio" name="companySize" value="1-10" required> 1-10 employees</label><br>
                    <label><input type="radio" name="companySize" value="11-50" required> 11-50 employees</label><br>
                    <label><input type="radio" name="companySize" value="51-250" required> 51-250 employees</label><br>
                    <label><input type="radio" name="companySize" value="251-1000" required> 251-1,000 employees</label><br>
                    <label><input type="radio" name="companySize" value="over_1000" required> Over 1,000 employees</label>
                </div>
                <div class="form-group radio-group" data-group-name="annualRevenue">
                    <p>What is your approximate annual revenue?</p>
                    <p class="small-text">This helps us determine the potential level of scrutiny and scale of compliance penalties.</p>
                    <label><input type="radio" name="annualRevenue" value="1-249k" required> $1 - $249k</label><br>
                    <label><input type="radio" name="annualRevenue" value="250k-499k" required> $250k - $499k</label><br>
                    <label><input type="radio" name="annualRevenue" value="500k-749k" required> $500k - $749k</label><br>
                    <label><input type="radio" name="annualRevenue" value="750k-999k" required> $750k - $999k</label><br>
                    <label><input type="radio" name="annualRevenue" value="1M+" required> $1M+</label>
                </div>
                <div class="navigation-buttons">
                    <button type="button" id="prevStep2">Previous</button>
                    <button type="button" id="nextStep2">Next</button>
                </div>
            </div>

            <div class="form-step" data-step="3">
                <h2>Your Customers</h2>
                <div class="form-group checkbox-group" data-group-name="customerLocation">
                    <p>Where are your customers located?</p>
                    <p class="small-text">Select all that apply.</p>
                    <label><input type="checkbox" name="customerLocation" value="united_states"> United States</label><br>
                    <label><input type="checkbox" name="customerLocation" value="european_union"> European Union</label><br>
                    <label><input type="checkbox" name="customerLocation" value="united_kingdom"> United Kingdom</label><br>
                    <label><input type="checkbox" name="customerLocation" value="other_general"> Other/General</label>
                </div>
                <div class="form-group radio-group" data-group-name="customerType">
                    <p>Who are your customers?</p>
                    <label><input type="radio" name="customerType" value="consumers" required> Consumers</label><br>
                    <label><input type="radio" name="customerType" value="businesses" required> Businesses</label><br>
                    <label><input type="radio" name="customerType" value="both" required> Both</label>
                </div>
                <div class="navigation-buttons">
                    <button type="button" id="prevStep3">Previous</button>
                    <button type="button" id="nextStep3">Next</button>
                </div>
            </div>

            <div class="form-step" data-step="4">
                <h2>Data Collected</h2>
                <div class="form-group checkbox-group" data-group-name="dataType">
                    <p>What types of data do you collect or process?</p>
                    <p class="small-text">Select all that apply.</p>
                    <label><input type="checkbox" name="dataType" value="basic_contact"> Basic contact info</label><br>
                    <label><input type="checkbox" name="dataType" value="health_phi"> Health or medical information (PHI)</label><br>
                    <label><input type="checkbox" name="dataType" value="genetics"> Genetics</label><br>
                    <label><input type="checkbox" name="dataType" value="financial"> Financial information (credit card numbers, bank accounts)</label><br>
                    <label><input type="checkbox" name="dataType" value="biometrics"> Biometrics</label><br>
                    <label><input type="checkbox" name="dataType" value="under_16"> Data on individuals under 16 years old</label><br>
                    <label><input type="checkbox" name="dataType" value="racial_ethnic"> Racial or ethnic origin</label><br>
                    <label><input type="checkbox" name="dataType" value="political_opinion"> Political opinions (including trade union membership)</label><br>
                    <label><input type="checkbox" name="dataType" value="religious_philosophical"> Religious or philosophical beliefs</label><br>
                    <label><input type="checkbox" name="dataType" value="sex_life_orientation"> Sex life or orientation</label>
                </div>
                <div class="navigation-buttons">
                    <button type="button" id="prevStep4">Previous</button>
                    <button type="button" id="nextStep4">Next</button>
                </div>
            </div>

            <div class="form-step" data-step="5">
                <h2>Where should we send your report?</h2>
                <div class="form-group">
                    <label for="fullName">Full Name:</label>
                    <input type="text" id="fullName" name="fullName" placeholder="John Doe" required>
                </div>
                <div class="form-group">
                    <label for="businessName">Business Name:</label>
                    <input type="text" id="businessName" name="businessName" placeholder="e.g., Acme Co." required>
                </div>
                <div class="form-group">
                    <label for="yourEmail">Email:</label>
                    <input type="email" id="yourEmail" name="yourEmail" placeholder="your@example.com" required>
                </div>
                <div class="navigation-buttons">
                    <button type="button" id="prevStep5">Previous</button>
                    <button type="button" id="generateReportButton">Generate Report</button>
                </div>
            </div>
        </div> <div id="results-section">
            <h2>Your Customized Risk Analysis for <span id="reportBusinessName"></span></h2>
            <p>Based on your answers, we have estimated an approximate risk level for your business. The lower the score, the lower your business's estimated individual risk.</p>
            <p>Please note that every business is different, and this is based on only a few data points. For a more in-depth analysis, you can reach out to us for a <a href="https://www.aetos-data.com/contact" target="_blank" style="color: #447073; text-decoration: none;">free preliminary consultation</a>.</p>
            <div id="regulationsOutput">
                </div>
            <p>A copy of this report has been sent to <strong id="reportEmailAddress"></strong>.</p>
            <p style="display: none;">
                <a id="emailReportLink" href="#" target="_blank" style="color: #447073; text-decoration: none;">Click here to email this report to yourself (opens in your email client).</a>
            </p>
            <button id="startOverButton" style="margin-top: 20px;">Start Over</button>
            <div class="next-steps-section">
                <h3>See the Full Picture</h3>
                <p>You've seen the tip of the iceberg. The free assessment flags potential vulnerabilities. For just $75, our Comprehensive Assessment dives deep to uncover your full risk profile and gives you a clear plan to mitigate it.</p>
                <a href="https://www.aetos-data.com/services/p/compliance-snapshot-expert-review" target="_blank" class="action-button">Uncover My Full Risk Profile</a>
            </div>
        </div>
    </div>

    <script>
        console.log("Script started executing (outside DOMContentLoaded): " + new Date().toLocaleString()); // Debug: Script started

        // --- Configuration: Your Zapier Webhook URL ---
        const ZAPIER_WEBHOOK_URL = 'https://hooks.zapier.com/hooks/catch/21168350/u2yjtw7/'; // Your specific Zapier Webhook URL

        // --- GLOBAL VARIABLES (Accessible to onclick attributes) ---
        let formIntro, regulationFormContainer, startAnalysisButton, formSteps, resultsSection, reportBusinessNameSpan,
            reportEmailAddressStrong, regulationsOutput, emailReportLink, startOverButton, generateReportButton, nextStepsButtonInResults; // nextStepsButton changed to nextStepsButtonInResults
        
        let currentStep = 0;
        let totalSteps = 0; // Will be set in initApp

        // --- Regulatory Data Definition (etc.) - These can be global constants ---
        const regulationsData = [
            {
                name: "GDPR (General Data Protection Regulation)",
                description: "A comprehensive data privacy law protecting individuals within the European Union and European Economic Area. It applies to any organization, regardless of its location, that processes personal data of EU residents.",
                conditions: {
                    customerLocation: ['european_union'],
                    customerType: ['consumers', 'businesses', 'both'],
                    dataType: ['basic_contact', 'health_phi', 'genetics', 'financial', 'biometrics', 'under_16', 'racial_ethnic', 'political_opinion', 'religious_philosophical', 'sex_life_orientation']
                },
                baseScore: 100,
                priority: 1
            },
            {
                name: "UK GDPR (General Data Protection Regulation)",
                description: "A comprehensive data privacy law protecting individuals within the United Kingdom. It applies to any organization in or targeting individuals in the UK.",
                conditions: {
                    customerLocation: ['united_kingdom'],
                    customerType: ['consumers', 'businesses', 'both'],
                    dataType: ['basic_contact', 'health_phi', 'genetics', 'financial', 'biometrics', 'under_16', 'racial_ethnic', 'political_opinion', 'religious_philosophical', 'sex_life_orientation']
                },
                baseScore: 100,
                priority: 3
            },
            {
                name: "ePrivacy Directive",
                description: "ePrivacy refers to a set of laws and regulations, most notably the ePrivacy Directive in the EU, that aim to protect the privacy of electronic communications and user data online, particularly concerning cookies, direct marketing, and confidentiality of communications. It applies to any organization, regardless of its location, that processes personal data of EU residents.",
                conditions: {
                    customerLocation: ['european_union'],
                    customerType: ['consumers', 'businesses', 'both'],
                    dataType: ['basic_contact', 'health_phi', 'genetics', 'financial', 'biometrics', 'under_16', 'racial_ethnic', 'political_opinion', 'religious_philosophical', 'sex_life_orientation']
                },
                baseScore: 42,
                priority: 4
            },
            {
                name: "Privacy & Electronic Communications Regulations (PECR)",
                description: "The UK's national implementation of the original EU ePrivacy Directive. ePrivacy refers to a set of laws and regulations, that aim to protect the privacy of electronic communications and user data online, particularly concerning cookies, direct marketing, and confidentiality of communications. It applies to any organization, regardless of its location, that processes personal data of UK residents.",
                conditions: {
                    customerLocation: ['united_kingdom'],
                    customerType: ['consumers', 'businesses', 'both'],
                    dataType: ['basic_contact', 'health_phi', 'genetics', 'financial', 'biometrics', 'under_16', 'racial_ethnic', 'political_opinion', 'religious_philosophical', 'sex_life_orientation']
                },
                baseScore: 42,
                priority: 5
            },
            {
                name: "Data Protection Act of 2018",
                description: "A regulation that complements the UK GDPR and grants individuals rights regarding their personal data. It applies to any organization in or targeting individuals in the UK.",
                conditions: {
                    customerLocation: ['united_kingdom'],
                    customerType: ['consumers', 'businesses', 'both'],
                    dataType: ['basic_contact', 'health_phi', 'genetics', 'financial', 'biometrics', 'under_16', 'racial_ethnic', 'political_opinion', 'religious_philosophical', 'sex_life_orientation']
                },
                baseScore: 49,
                priority: 6
            },
            {
                name: "CCPA (California Consumer Privacy Act)",
                description: "The California Consumer Privacy Act grants California consumers specific rights regarding their personal information collected by businesses, including the right to know, delete, and opt-out of the sale of their data. For businesses that meet specific thresholds (e.g., revenue, data processing volume).",
                conditions: {
                    customerLocation: ['united_states'],
                    customerType: ['consumers', 'businesses', 'both'],
                    annualRevenue: ['1M+', '750k-999k', '500k-749k', '250k-499k', '1-249k'],
                    dataType: ['basic_contact', 'health_phi', 'genetics', 'financial', 'biometrics', 'under_16', 'racial_ethnic', 'political_opinion', 'religious_philosophical', 'sex_life_orientation']
                },
                baseScore: 56,
                priority: 7
            },
            {
                name: "CAN-SPAM",
                description: "The Controlling the Assault of Non-Solicited Pornography And Marketing Act of 2003 establishes national standards for the sending of commercial emails, primarily requiring accurate sender information, clear identification of advertisements, and an easy opt-out mechanism.",
                conditions: {
                    customerLocation: ['united_states'],
                    customerType: ['consumers', 'businesses', 'both'],
                    dataType: ['basic_contact', 'health_phi', 'genetics', 'financial', 'biometrics', 'under_16', 'racial_ethnic', 'political_opinion', 'religious_philosophical', 'sex_life_orientation']
                },
                baseScore: 20,
                priority: 8
            },
            {
                name: "VPPA (Video Privacy Protection Act)",
                description: "The Video Privacy Protection Act prohibits video tape service providers from knowingly disclosing personally identifiable information about a consumer's video rentals without their informed, written consent.",
                conditions: {
                    customerLocation: ['united_states'],
                    customerType: ['consumers', 'businesses', 'both'],
                    dataType: ['basic_contact', 'health_phi', 'genetics', 'financial', 'biometrics', 'under_16', 'racial_ethnic', 'political_opinion', 'religious_philosophical', 'sex_life_orientation']
                },
                baseScore: 12,
                priority: 9
            },
            {
                name: "HIPAA (Health Insurance Portability and Accountability Act)",
                description: "A U.S. law protecting sensitive patient health information from being disclosed without the patient's consent or knowledge. Applies primarily to healthcare providers, health plans, and healthcare clearinghouses.",
                conditions: {
                    industry: ['healthcare'],
                    customerLocation: ['united_states'],
                    dataType: ['health_phi']
                },
                baseScore: 64,
                priority: 10
            },
            {
                name: "CIPA (Children's Internet Protection Act)",
                description: "The Children's Internet Protection Act requires schools and libraries that receive federal funding for internet access to implement internet safety policies, including technology protection measures to block or filter obscene or harmful content for minors.",
                conditions: {
                    customerLocation: ['united_states'],
                    industry: ['education']
                },
                baseScore: 6,
                priority: 11
            },
            {
                name: "TCPA (Telephone Consumer Protection Act)",
                description: "The Telephone Consumer Protection Act restricts telemarketing calls, automatic telephone dialing systems, and artificial or prerecorded voice messages, requiring prior consent for many types of calls and texts.",
                conditions: {
                    customerLocation: ['united_states'],
                    customerType: ['consumers', 'businesses', 'both'],
                    dataType: ['basic_contact', 'health_phi', 'genetics', 'financial', 'biometrics', 'under_16', 'racial_ethnic', 'political_opinion', 'religious_philosophical', 'sex_life_orientation']
                },
                baseScore: 56,
                priority: 12
            },
            {
                name: "GLBA (Gramm-Leach-Bliley Act)",
                description: "The Gramm-Leach-Bliley Act requires financial institutions to explain their information-sharing practices to customers and to safeguard sensitive data, covering privacy, security, and pretexting rules.",
                conditions: {
                    customerLocation: ['united_states'],
                    customerType: ['consumers', 'businesses', 'both'],
                    dataType: ['financial']
                },
                baseScore: 25,
                priority: 13
            },
            {
                name: "COPPA (Children's Online Privacy Protection Act)",
                description: "The Children's Online Privacy Protection Act imposes requirements on operators of websites or online services directed at children under 13, or that knowingly collect personal information from children under 13, to obtain verifiable parental consent.",
                conditions: {
                    customerLocation: ['united_states'],
                    customerType: ['consumers', 'businesses', 'both'],
                    dataType: ['under_16']
                },
                baseScore: 81,
                priority: 14
            },
            {
                name: "BIPA (Illinois Biometric Information Privacy Act)",
                description: "The Illinois Biometric Information Privacy Act requires private entities to obtain written consent before collecting, capturing, purchasing, receiving, or otherwise obtaining a person's biometric identifiers or biometric information, and places restrictions on the storage, use, and disclosure of such data.",
                conditions: {
                    customerLocation: ['united_states'],
                    customerType: ['consumers', 'businesses', 'both'],
                    dataType: ['biometrics']
                },
                baseScore: 81,
                priority: 15
            },
            {
                name: "Federal Trade Commission (FTC)",
                description: "The FTC serves as the primary federal agency protecting consumer privacy in the United States by prohibiting unfair or deceptive acts and practices, especially concerning how companies collect, use, and secure personal data across various industries (excluding certain regulated sectors).",
                conditions: {
                    customerLocation: ['united_states']
                },
                baseScore: 30,
                priority: 16
            },
            {
                name: "Federal Communications Commission (FCC)",
                description: "The FCC primarily focuses on protecting consumer privacy within the telecommunications sector, setting rules for how phone companies, internet service providers, and other communication service providers handle sensitive customer data like Customer Proprietary Network Information (CPNI).",
                conditions: {
                    customerLocation: ['united_states'],
                    industry: ['technology', 'healthcare', 'ecommerce', 'financial_services', 'marketing_advertising', 'education', 'other_industry']
                },
                baseScore: 28,
                priority: 17
            }
        ];

        // --- Coefficients Data ---
        const coefficientsData = {
            companySize: {
                '51-250': 1.4,
                '251-1000': 1.6,
                'over_1000': 2
            },
            industry: {
                'technology': 1.8,
                'healthcare': 2,
                'ecommerce': 1.2,
                'financial_services': 1.6,
                'marketing_advertising': 1.4,
                'education': 0.8
            },
            // dataType is commented out as it has no coefficients yet
        };

        // --- GLOBAL FUNCTION: handleStartAnalysisClick ---
        // This function needs to be global so onclick attribute can find it.
        function handleStartAnalysisClick() {
            console.log("Start Analysis button clicked (via onclick). Attempting transition to form.");
            try {
                // Ensure DOM elements are available. This part requires elements to be selected inside DOMContentLoaded first.
                // We'll trust that DOMContentLoaded will set these variables up correctly.
                if (formIntro && regulationFormContainer && formSteps && formSteps.length > 0) {
                    formIntro.style.display = 'none';
                    regulationFormContainer.style.display = 'block';
                    showStep(0); // Assuming showStep is also properly defined and accessible
                    console.log("Transition to form completed.");
                } else {
                    console.error("Critical: DOM elements not fully initialized for handleStartAnalysisClick. Retrying initialization.");
                    // Attempt a delayed re-initialization if elements aren't ready
                    setTimeout(initApp, 100); // Try to re-run initApp shortly
                }
            } catch (e) {
                console.error("Error in handleStartAnalysisClick:", e);
                alert("An error occurred starting the analysis. Please check the console.");
            }
        }


        // --- MAIN APP INITIALIZATION FUNCTION ---
        // This function will be called on DOMContentLoaded or as a fallback
        function initApp() {
            console.log("Attempting initApp execution."); // Debug: initApp called

            try {
                // DOM Elements - Re-select to ensure they are current/found
                formIntro = document.querySelector('.form-intro');
                regulationFormContainer = document.getElementById('regulationFormContainer');
                startAnalysisButton = document.getElementById('startAnalysisButton');
                formSteps = document.querySelectorAll('.form-step');
                resultsSection = document.getElementById('results-section');
                reportBusinessNameSpan = document.getElementById('reportBusinessName');
                reportEmailAddressStrong = document.getElementById('reportEmailAddress');
                regulationsOutput = document.getElementById('regulationsOutput');
                emailReportLink = document.getElementById('emailReportLink');
                startOverButton = document.getElementById('startOverButton');
                generateReportButton = document.getElementById('generateReportButton');
                nextStepsButtonInResults = resultsSection.querySelector('.next-steps-section .action-button');

                totalSteps = formSteps.length; // Update totalSteps after selecting formSteps

                // Basic check if critical elements are now found
                if (!formIntro || !regulationFormContainer || totalSteps === 0 || !startAnalysisButton || !resultsSection || !generateReportButton) {
                    console.error("FATAL ERROR: One or more critical DOM elements could not be found during initApp.");
                    console.error("formIntro:", formIntro, "regulationFormContainer:", regulationFormContainer, "totalSteps:", totalSteps, "startAnalysisButton:", startAnalysisButton, "resultsSection:", resultsSection, "generateReportButton:", generateReportButton);
                    // Alert only if not already alerted to avoid spam
                    if (!window._appInitFailedAlerted) {
                        alert("App failed to fully initialize. Please contact support and mention console errors.");
                        window._appInitFailedAlerted = true; // Set flag to prevent multiple alerts
                    }
                    return; // Stop further execution if critical elements are missing
                }
                console.log("All critical DOM elements found in initApp."); // Debug Log

                // --- Attach Event Listeners (now that elements are guaranteed to be found) ---
                // startAnalysisButton.addEventListener('click', handleStartAnalysisClick); // Removed redundant addEventListener
                // onclick on HTML handles this directly.

                document.getElementById('nextStep1').addEventListener('click', function() {
                    if (validateStep(0)) { showStep(1); } else { alert('Please complete all required fields in this section to proceed.'); }
                });
                document.getElementById('nextStep2').addEventListener('click', function() {
                    if (validateStep(1)) { showStep(2); } else { alert('Please complete all required fields in this section to proceed.'); }
                });
                document.getElementById('nextStep3').addEventListener('click', function() {
                    if (validateStep(2)) { showStep(3); } else { alert('Please complete all required fields in this section to proceed.'); }
                });
                document.getElementById('nextStep4').addEventListener('click', function() {
                    if (validateStep(3)) { showStep(4); } else { alert('Please complete all required fields in this section to proceed.'); }
                });

                document.getElementById('prevStep2').addEventListener('click', function() { showStep(0); });
                document.getElementById('prevStep3').addEventListener('click', function() { showStep(1); });
                document.getElementById('prevStep4').addEventListener('click', function() { showStep(2); });
                document.getElementById('prevStep5').addEventListener('click', function() { showStep(3); });

                generateReportButton.addEventListener('click', async function(event) {
                    console.log("Generate Report button clicked.");

                    if (!validateStep(totalSteps - 1)) {
                        alert('Please complete all required fields to generate the report.');
                        return;
                    }

                    const formData = {
                        industry: document.querySelector('input[name="industry"]:checked')?.value || '',
                        companySize: document.querySelector('input[name="companySize"]:checked')?.value || '',
                        annualRevenue: document.querySelector('input[name="annualRevenue"]:checked')?.value || '',
                        customerLocation: Array.from(document.querySelectorAll('input[name="customerLocation"]:checked')).map(cb => cb.value),
                        customerType: document.querySelector('input[name="customerType"]:checked')?.value || '',
                        dataType: Array.from(document.querySelectorAll('input[name="dataType"]:checked')).map(cb => cb.value),
                        fullName: document.getElementById('fullName').value.trim(),
                        businessName: document.getElementById('businessName').value.trim(),
                        yourEmail: document.getElementById('yourEmail').value.trim()
                    };
                    console.log("Collected formData:", formData);

                    const reportContentHtml = generateReport(formData);
                    regulationsOutput.innerHTML = reportContentHtml;

                    reportBusinessNameSpan.textContent = formData.businessName;
                    reportEmailAddressStrong.textContent = formData.yourEmail;

                    regulationFormContainer.style.display = 'none';
                    resultsSection.style.display = 'block';
                    console.log("Report displayed on site.");

                    const flattenedDataToSend = {
                        timestamp: new Date().toISOString(),
                        industry: formData.industry,
                        companySize: formData.companySize,
                        annualRevenue: formData.annualRevenue,
                        customerType: formData.customerType,
                        fullName: formData.fullName,
                        businessName: formData.businessName,
                        yourEmail: formData.yourEmail,
                        customerLocation: formData.customerLocation.join(', '),
                        dataType: formData.dataType.join(', '),
                        generatedReportHtml: reportContentHtml,
                        generatedReportPlainText: finalApplicableRegulations.length > 0 ?
                            "Applicable Regulations (Calculated Risk Score):\n\n" +
                            finalApplicableRegulations.map(reg => `${reg.name}: ${reg.description}\nYour estimated risk score (out of 100): ${reg.calculatedRiskScore}`).join('\n\n') :
                            'No specific regulations found based on your input.'
                    };
                    console.log("Data prepared for Zapier (URL-encoded):", flattenedDataToSend);

                    try {
                        const response = await fetch(ZAPIER_WEBHOOK_URL, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'
                            },
                            body: new URLSearchParams(flattenedDataToSend).toString()
                        });

                        if (response.ok) {
                            console.log('Data successfully sent to Zapier (URL-encoded)! Response OK.');
                        } else {
                            console.error('Failed to send data to Zapier:', response.status, response.statusText);
                        }
                    } catch (error) {
                        console.error('Error sending data to Zapier:', error);
                    }

                    const reportPlainTextEmail = `
Dear ${formData.fullName || formData.businessName},

Here is your customized Business Regulation Report based on the information you provided:

Business Name: ${formData.businessName}
Your Email: ${formData.yourEmail}
Industry: ${formData.industry}
Company Size: ${formData.companySize}
Annual Revenue: ${formData.annualRevenue}
Customer Locations: ${formData.customerLocation.length > 0 ? formData.customerLocation.join(', ') : 'N/A'}
Customer Type: ${formData.customerType}
Data Types Collected: ${formData.dataType.length > 0 ? formData.dataType.join(', ') : 'N/A'}

--- Applicable Regulations ---

${finalApplicableRegulations.length > 0 ? finalApplicableRegulations.map(reg => `${reg.name}: ${reg.description}\nYour estimated risk score (out of 100): ${reg.calculatedRiskScore}`).join('\n\n') : 'No specific regulations found based on your input.'}

---

Disclaimer: This is not legal advice. The results are for informational purposes only. By using this tool, you agree that we may contact you to discuss your results and our services.

Best regards,
[Your Business Name/Signature]
                `.trim();

                    const emailSubject = encodeURIComponent(`Your Business Regulation Report for ${formData.businessName}`);
                    const emailBody = encodeURIComponent(reportPlainTextEmail);

                    emailReportLink.href = `mailto:${formData.yourEmail}?subject=${emailSubject}&body=${emailBody}`;
                    emailReportLink.style.display = 'block';
                    console.log("Mailto link prepared.");
                });

                startOverButton.addEventListener('click', function() {
                    console.log("Start Over button clicked. Resetting form.");
                    resultsSection.style.display = 'none';
                    formIntro.style.display = 'block';

                    document.getElementById('fullName').value = '';
                    document.getElementById('businessName').value = '';
                    document.getElementById('yourEmail').value = '';
                    
                    document.querySelectorAll('input[type="radio"]').forEach(radio => radio.checked = false);
                    document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => checkbox.checked = false);

                    document.querySelectorAll('.invalid-group-border').forEach(el => el.classList.remove('invalid-group-border'));
                    document.querySelectorAll('input[type="text"], input[type="email"], select').forEach(input => input.style.borderColor = '#ddd');
                    regulationsOutput.innerHTML = '';

                    emailReportLink.style.display = 'none';
                    emailReportLink.href = '#';

                    regulationFormContainer.style.display = 'none';
                    currentStep = 0;
                    console.log("Form reset complete.");
                });

                nextStepsButtonInResults.addEventListener('click', function() {
                    console.log("Next steps button clicked. Opening contact page.");
                    window.open('https://www.aetos-data.com/services/p/compliance-snapshot-expert-review', '_blank');
                });

                // Initial setup: Ensure only the intro is visible at page load
                formIntro.style.display = 'block';
                regulationFormContainer.style.display = 'none';
                resultsSection.style.display = 'none';
                console.log("Initial display states set."); // Debug Log

            } catch (e) {
                console.error("An error occurred during app initialization (initApp function):", e);
                // No alert here, rely on initApp's own alerting and console for initial setup issues
            }
        }


        // --- MAIN ENTRY POINT ---
        // Try DOMContentLoaded first, which is standard.
        // If that fails due to external scripts, the onclick attribute will act as a fallback,
        // calling handleStartAnalysisClick which has its own robust element checks.
        document.addEventListener('DOMContentLoaded', initApp);

        // Fallback for very unusual scenarios where DOMContentLoaded might not be enough
        // This will attempt to initialize the app even after everything on the page is loaded.
        window.onload = function() {
            console.log("Window fully loaded. Checking if app initialized.");
            if (!formIntro || !formIntro.style || formIntro.style.display !== 'block') { // Check if initApp failed to set initial state
                console.warn("App's initial state not set, attempting re-initialization via window.onload.");
                initApp();
            }
        };

    </script>

</body>
</html>
